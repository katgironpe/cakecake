// Generated by CoffeeScript 1.3.3
(function() {
  var Announcer, AppData, Art, Block, Builder, Bullet, Button, ClipVertex, Editor, Entity, Features, Fly, Game, GameController, Grid, IBroadPhase, ImageLoader, Keyboard, Level, Level10, Level11, Level2, Level3, Level4, Level5, Level6, Level7, Level8, Level9, Menu, Menu_1D, Menu_2D, Physics, Spider, Sprite, Text, Web, World, b2AABB, b2Body, b2BodyDef, b2Bound, b2BoundValues, b2CircleContact, b2CircleShape, b2Collision, b2Color, b2Contact, b2ContactConstraint, b2ContactConstraintPoint, b2ContactEdge, b2ContactFactory, b2ContactFilter, b2ContactID, b2ContactImpulse, b2ContactListener, b2ContactManager, b2ContactPoint, b2ContactRegister, b2ContactResult, b2ContactSolver, b2Controller, b2ControllerEdge, b2DebugDraw, b2DestructionListener, b2Distance, b2DistanceInput, b2DistanceJoint, b2DistanceJointDef, b2DistanceOutput, b2DistanceProxy, b2DynamicTree, b2DynamicTreeBroadPhase, b2DynamicTreeNode, b2DynamicTreePair, b2EdgeAndCircleContact, b2EdgeChainDef, b2EdgeShape, b2FilterData, b2Fixture, b2FixtureDef, b2FrictionJoint, b2FrictionJointDef, b2GearJoint, b2GearJointDef, b2Island, b2Jacobian, b2Joint, b2JointDef, b2JointEdge, b2LineJoint, b2LineJointDef, b2Manifold, b2ManifoldPoint, b2MassData, b2Mat22, b2Mat33, b2Math, b2MouseJoint, b2MouseJointDef, b2NullContact, b2Point, b2PolyAndCircleContact, b2PolyAndEdgeContact, b2PolygonContact, b2PolygonShape, b2PositionSolverManifold, b2PrismaticJoint, b2PrismaticJointDef, b2PulleyJoint, b2PulleyJointDef, b2RayCastInput, b2RayCastOutput, b2RevoluteJoint, b2RevoluteJointDef, b2Segment, b2SeparationFunction, b2Settings, b2Shape, b2Simplex, b2SimplexCache, b2SimplexVertex, b2Sweep, b2TOIInput, b2TimeOfImpact, b2TimeStep, b2Transform, b2Vec2, b2Vec3, b2WeldJoint, b2WeldJointDef, b2World, b2WorldManifold, b2internal,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  Art = (function() {

    Art.prototype.world = null;

    function Art(world) {
      this.world = world;
    }

    Art.prototype.get_alpha = function() {
      return Game.context.globalAlpha;
    };

    Art.prototype.alpha = function(alpha) {
      return Game.context.globalAlpha = alpha;
    };

    Art.prototype.color = function(color) {
      Game.context.fillStyle = color;
      return Game.context.strokeStyle = color;
    };

    Art.prototype.fill_color = function(color) {
      return Game.context.fillStyle = color;
    };

    Art.prototype.stroke_color = function(color) {
      return Game.context.strokeStyle = color;
    };

    Art.prototype.lineC = function(x1, y1, x2, y2) {
      Game.context.beginPath();
      Game.context.moveTo(x1 + 0.5, y1 + 0.5);
      Game.context.lineTo(x2 + 0.5, y2 + 0.5);
      return Game.context.stroke();
    };

    Art.prototype.line = function(x, y, x2, y2) {
      return this.lineC(x + this.world.x, y + this.world.y, x2 + this.world.x, y2 + this.world.y);
    };

    Art.prototype.rectangleC = function(x, y, w, h, filled) {
      if (filled == null) {
        filled = false;
      }
      if (filled === true) {
        return Game.context.fillRect(x, y, w, h);
      } else {
        return Game.context.strokeRect(x, y, w, h);
      }
    };

    Art.prototype.rectangle = function(x, y, w, h, filled) {
      if (filled == null) {
        filled = false;
      }
      return Art.rectangleC(x + Art.offset_x, y + Art.offset_y, w, h, filled);
    };

    return Art;

  })();

  Entity = (function() {

    function Entity() {}

    Entity.prototype.x = 0;

    Entity.prototype.y = 0;

    Entity.prototype.sx = 0;

    Entity.prototype.sy = 0;

    Entity.prototype.w = void 0;

    Entity.prototype.h = void 0;

    Entity.prototype.r = void 0;

    Entity.prototype.visible = true;

    Entity.prototype.name = null;

    Entity.prototype.scale_x = 1;

    Entity.prototype.scale_y = 1;

    Entity.prototype.offset_x = 0;

    Entity.prototype.offset_y = 0;

    Entity.prototype.alpha = 1;

    Entity.prototype.rotation = 0;

    Entity.prototype.index = 1;

    Entity.prototype.sprite = null;

    Entity.prototype.world = null;

    Entity.prototype.art = null;

    Entity.prototype.z = 0;

    Entity.prototype.hit_hash = {};

    Entity.prototype.draw = function() {
      if (this.sprite) {
        this.sprite.rotation = this.rotation;
        this.sprite.w = this.w;
        this.sprite.h = this.h;
        this.sprite.x = this.world.x + this.x;
        this.sprite.y = this.world.y + this.y;
        return this.sprite.draw();
      }
    };

    Entity.prototype.init = function() {
      return null;
    };

    Entity.prototype.set_x = function(x) {
      this.x = x;
      return this.update_position();
    };

    Entity.prototype.set_y = function(y) {
      this.y = y;
      return this.update_position();
    };

    Entity.prototype.update_position = function() {
      if (this.physics && this.body) {
        return this.body.SetPosition(new b2Vec2(this.x / 16, this.y / 16));
      }
    };

    Entity.prototype.set_rotation = function(rotation) {
      this.rotation = rotation;
      if (this.physics && this.body) {
        return this.body.SetAngle((-this.rotation / 360) * Math.PI * 2);
      }
    };

    Entity.prototype.set_w = function(w) {
      return this.w = w;
    };

    Entity.prototype.set_h = function(h) {
      return this.h = h;
    };

    Entity.prototype.step = function() {
      var p;
      if (this.physics && this.body) {
        p = this.body.GetPosition();
        this.x = p.x * 16;
        this.y = p.y * 16;
        this.sprite.rotation = -this.body.GetAngle() / (Math.PI * 2) * 360;
      }
      return null;
    };

    Entity.prototype.move_towards = function(x, y, speed) {
      var dir;
      dir = this.direction_to(x, y);
      this.x += Math.cos(dir / 180 * Math.PI) * speed;
      return this.y -= Math.sin(dir / 180 * Math.PI) * speed;
    };

    Entity.prototype.direction_to = function(x, y) {
      var dx, dy;
      dx = x - this.x;
      dy = y - this.y;
      return -Math.atan2(dy, dx) * 180 / Math.PI;
    };

    Entity.prototype.nearest = function(c) {
      var distance, e, nearest, shortest, _i, _len, _ref;
      shortest = 9999;
      nearest = null;
      _ref = this.world.all_entities();
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        e = _ref[_i];
        if (e.name === c && e !== this) {
          distance = this.objects_distance(this, e);
          if (distance < shortest) {
            nearest = e;
            shortest = distance;
          }
        }
      }
      return nearest;
    };

    Entity.prototype.touch = function(c) {
      var key, val, _ref;
      _ref = this.hit_hash;
      for (key in _ref) {
        val = _ref[key];
        if (val.name === c) {
          return val;
        }
      }
      return null;
    };

    Entity.prototype.hit = function(c) {
      var e, _i, _len, _ref;
      _ref = this.world.all_entities();
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        e = _ref[_i];
        if (e.name === c) {
          if (this.objects_touch(this, e)) {
            return e;
          }
        }
      }
      return null;
    };

    Entity.prototype.hits = function(c) {
      var e, res, _i, _len, _ref;
      res = [];
      _ref = this.world.all_entities();
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        e = _ref[_i];
        if (e.name === c) {
          if (this.objects_touch(this, e)) {
            res.push(e);
          }
        }
      }
      return res;
    };

    Entity.prototype.spawn = function(cl) {
      return this.world.spawn(cl, this.x, this.y);
    };

    Entity.prototype.objects_touch_circle = function() {
      return this.objects_distance(obj1, obj2) <= obj1.r + obj2.r;
    };

    Entity.prototype.objects_touch = function(obj1, obj2) {
      var d1, d2, l1, l2, r1, r2, u1, u2;
      l1 = obj1.x - obj1.w / 2;
      r1 = obj1.x + obj1.w / 2;
      l2 = obj2.x - obj2.w / 2;
      r2 = obj2.x + obj2.w / 2;
      u1 = obj1.y - obj1.h / 2;
      d1 = obj1.y + obj1.h / 2;
      u2 = obj2.y - obj2.h / 2;
      d2 = obj2.y + obj2.h / 2;
      return r1 > l2 && l1 < r2 && d1 > u2 && u1 < d2;
    };

    Entity.prototype.objects_distance = function(obj1, obj2) {
      return this.points_distance(obj1.x, obj1.y, obj2.x, obj2.y);
    };

    Entity.prototype.points_distance = function(x1, y1, x2, y2) {
      return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));
    };

    Entity.prototype.destroy = function() {
      if (this.body) {
        this.world.physics.world.DestroyBody(this.body);
      }
      return this.world.destroy(this);
    };

    Entity.prototype.reset = function() {
      this.x = this.sx;
      return this.y = this.sy;
    };

    Entity.prototype.mouse_hits = function() {
      return Keyboard.MOUSE_X > this.x - this.w / 2 && Keyboard.MOUSE_X < this.x + this.w / 2 && Keyboard.MOUSE_Y > this.y - this.h / 2 && Keyboard.MOUSE_Y < this.y + this.h / 2;
    };

    return Entity;

  })();

  Game = (function() {

    function Game() {}

    Game.context = null;

    Game.worlds = [];

    Game.images = {};

    Game.zoom_level = 1;

    Game.pause = false;

    Game.editor = null;

    Game.mode = "";

    Game.add_world = function() {
      var w;
      w = new World;
      Game.worlds.push(w);
      return w;
    };

    Game.init = function(mode) {
      var i;
      console.log('init');
      this.mode = mode;
      Game.context = Game.create_canvas();
      Game.set_zoom(AppData.scale);
      Game.setup_keyboard();
      i = new ImageLoader();
      i.onload = Game.start;
      return i.load_images();
    };

    Game.start = function() {
      var w;
      w = Game.add_world();
      w.load_level(AppData.start_level);
      if (Game.mode === "build") {
        Game.editor = new Editor(Game.worlds[0]);
      }
      return setInterval(Game.run, 16);
    };

    Game.set_zoom = function(rate) {
      Game.context.scale(rate / Game.zoom_level, rate / Game.zoom_level);
      return Game.zoom_level = rate;
    };

    Game.create_canvas = function() {
      var canvas, context;
      canvas = document.createElement("canvas");
      canvas.width = AppData.width * AppData.scale;
      canvas.height = AppData.height * AppData.scale;
      document.body.appendChild(canvas);
      context = canvas.getContext("2d");
      context.textBaseline = 'top';
      if (!AppData.anti_aliasing) {
        context.imageSmoothingEnabled = false;
        context.mozImageSmoothingEnabled = false;
        context.webkitImageSmoothingEnabled = false;
      }
      return context;
    };

    Game.setup_keyboard = function() {
      var canvas,
        _this = this;
      canvas = document.getElementsByTagName("canvas")[0];
      document.onkeydown = function(evt) {
        return Keyboard.key_pressed(evt.keyCode);
      };
      document.onkeyup = function(evt) {
        return Keyboard.key_released(evt.keyCode);
      };
      canvas.onmousemove = function(evt) {
        return Keyboard.mouse_move(evt);
      };
      canvas.onmousedown = function(evt) {
        return Keyboard.mouse_down(evt.which);
      };
      canvas.onmouseup = function(evt) {
        return Keyboard.mouse_up(evt.which);
      };
      canvas.oncontextmenu = function() {
        return false;
      };
      canvas.addEventListener("touchstart", Keyboard.touch_start, false);
      canvas.addEventListener("touchend", Keyboard.touch_end, false);
      canvas.addEventListener("touchcancel", Keyboard.touch_end, false);
      canvas.addEventListener("touchleave", Keyboard.touch_end, false);
      return canvas.addEventListener("touchmove", Keyboard.touch_move, false);
    };

    Game.run = function() {
      var world, _i, _len, _ref;
      _ref = Game.worlds;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        world = _ref[_i];
        world.step();
        world.draw();
      }
      if (Game.editor) {
        Game.editor.step();
        return Game.editor.draw();
      }
    };

    return Game;

  }).call(this);

  ImageLoader = (function() {
    var i, images_loaded, images_n;

    images_loaded = 0;

    images_n = 0;

    i = null;

    function ImageLoader() {
      this.image_loaded = __bind(this.image_loaded, this);
      images_n = Object.keys(AppData.sprites).length;
    }

    ImageLoader.prototype.load_images = function() {
      var file, name, _ref, _results;
      _ref = AppData.sprites;
      _results = [];
      for (name in _ref) {
        file = _ref[name];
        _results.push(this.load_image("sprites/" + file, name));
      }
      return _results;
    };

    ImageLoader.prototype.load_image = function(url, name, im) {
      var image,
        _this = this;
      image = new Image;
      image.src = url;
      image.onload = function() {
        return _this.image_loaded(name, image);
      };
      return image;
    };

    ImageLoader.prototype.image_loaded = function(name, image) {
      Game.images[name] = image;
      images_loaded += 1;
      if (images_loaded === images_n) {
        return this.onload();
      }
    };

    return ImageLoader;

  })();

  Keyboard = (function() {

    function Keyboard() {}

    Keyboard._keyCodes = {
      'BACKSPACE': 8,
      'TAB': 9,
      'ENTER': 13,
      'SHIFT': 16,
      'CTRL': 17,
      'ALT': 18,
      'CAPSLOCK': 20,
      'ESCAPE': 27,
      'SPACE': 32,
      'END': 35,
      'HOME': 36,
      'LEFT': 37,
      'UP': 38,
      'RIGHT': 39,
      'DOWN': 40,
      'INSERT': 45,
      'DELETE': 46,
      '0': 48,
      '1': 49,
      '2': 50,
      '3': 51,
      '4': 52,
      '5': 53,
      '6': 54,
      '7': 55,
      '8': 56,
      '9': 57,
      'A': 65,
      'B': 66,
      'C': 67,
      'D': 68,
      'E': 69,
      'F': 70,
      'G': 71,
      'H': 72,
      'I': 73,
      'J': 74,
      'K': 75,
      'L': 76,
      'M': 77,
      'N': 78,
      'O': 79,
      'P': 80,
      'Q': 81,
      'R': 82,
      'S': 83,
      'T': 84,
      'U': 85,
      'V': 86,
      'W': 87,
      'X': 88,
      'Y': 89,
      'Z': 90,
      'MULTIPLY': 106,
      'ADD': 107,
      'SUBTRACT': 109,
      'MOUSE_LEFT': 'MOUSE_LEFT',
      'MOUSE_MIDDLE': 'MOUSE_MIDDLE',
      'MOUSE_RIGHT': 'MOUSE_RIGHT',
      'TOUCH': 'TOUCH'
    };

    Keyboard._pre_pressed = [];

    Keyboard._pre_released = [];

    Keyboard._pressed = [];

    Keyboard._released = [];

    Keyboard._hold = [];

    Keyboard.key_released = function(c) {
      return Keyboard._pre_released.push(c);
    };

    Keyboard.key_pressed = function(c) {
      return Keyboard._pre_pressed.push(c);
    };

    Keyboard.touch_start = function(e) {
      return Keyboard._pre_pressed.push('TOUCH');
    };

    Keyboard.touch_end = function(e) {
      return Keyboard._pre_released.push('TOUCH');
    };

    Keyboard.touch_move = function(e) {
      Keyboard.TOUCH_X = e.touches[0].pageX;
      return Keyboard.TOUCH_Y = e.touches[0].pageY;
    };

    Keyboard.mouse_down = function(e) {
      switch (e) {
        case 1:
          Keyboard._pre_pressed.push('MOUSE_LEFT');
          break;
        case 2:
          Keyboard._pre_pressed.push('MOUSE_MIDDLE');
          break;
        case 3:
          Keyboard._pre_pressed.push('MOUSE_RIGHT');
      }
      return false;
    };

    Keyboard.mouse_up = function(e) {
      switch (e) {
        case 1:
          Keyboard._pre_released.push('MOUSE_LEFT');
          break;
        case 2:
          Keyboard._pre_released.push('MOUSE_MIDDLE');
          break;
        case 3:
          Keyboard._pre_released.push('MOUSE_RIGHT');
      }
      return false;
    };

    Keyboard.mouse_move = function(e) {
      Keyboard.MOUSE_XC = e.offsetX / Game.zoom_level;
      Keyboard.MOUSE_YC = e.offsetY / Game.zoom_level;
      Keyboard.MOUSE_X = Keyboard.MOUSE_XC;
      return Keyboard.MOUSE_Y = Keyboard.MOUSE_YC;
    };

    Keyboard.hold = function(keyName) {
      return Keyboard._hold.indexOf(Keyboard._keyCodes[keyName]) !== -1;
    };

    Keyboard.press = function(keyName) {
      return Keyboard._pressed.indexOf(Keyboard._keyCodes[keyName]) !== -1;
    };

    Keyboard.release = function(keyName) {
      return Keyboard._released.indexOf(Keyboard._keyCodes[keyName]) !== -1;
    };

    Keyboard.step = function() {
      Keyboard._pressed = Keyboard._pre_pressed.splice(0);
      Keyboard._released = Keyboard._pre_released.splice(0);
      Keyboard._hold = Keyboard._hold.concat(Keyboard._pressed);
      Keyboard._hold = Keyboard._hold.diff(Keyboard._released);
      Keyboard._pre_pressed = [];
      return Keyboard._pre_released = [];
    };

    return Keyboard;

  })();

  b2ControllerEdge = Box2D.Dynamics.Controllers.b2ControllerEdge;

  b2Mat22 = Box2D.Common.Math.b2Mat22;

  b2Mat33 = Box2D.Common.Math.b2Mat33;

  b2Math = Box2D.Common.Math.b2Math;

  b2Sweep = Box2D.Common.Math.b2Sweep;

  b2Transform = Box2D.Common.Math.b2Transform;

  b2Vec2 = Box2D.Common.Math.b2Vec2;

  b2Vec3 = Box2D.Common.Math.b2Vec3;

  b2Color = Box2D.Common.b2Color;

  b2internal = Box2D.Common.b2internal;

  b2Settings = Box2D.Common.b2Settings;

  b2AABB = Box2D.Collision.b2AABB;

  b2Bound = Box2D.Collision.b2Bound;

  b2BoundValues = Box2D.Collision.b2BoundValues;

  b2Collision = Box2D.Collision.b2Collision;

  b2ContactID = Box2D.Collision.b2ContactID;

  b2ContactPoint = Box2D.Collision.b2ContactPoint;

  b2Distance = Box2D.Collision.b2Distance;

  b2DistanceInput = Box2D.Collision.b2DistanceInput;

  b2DistanceOutput = Box2D.Collision.b2DistanceOutput;

  b2DistanceProxy = Box2D.Collision.b2DistanceProxy;

  b2DynamicTree = Box2D.Collision.b2DynamicTree;

  b2DynamicTreeBroadPhase = Box2D.Collision.b2DynamicTreeBroadPhase;

  b2DynamicTreeNode = Box2D.Collision.b2DynamicTreeNode;

  b2DynamicTreePair = Box2D.Collision.b2DynamicTreePair;

  b2Manifold = Box2D.Collision.b2Manifold;

  b2ManifoldPoint = Box2D.Collision.b2ManifoldPoint;

  b2Point = Box2D.Collision.b2Point;

  b2RayCastInput = Box2D.Collision.b2RayCastInput;

  b2RayCastOutput = Box2D.Collision.b2RayCastOutput;

  b2Segment = Box2D.Collision.b2Segment;

  b2SeparationFunction = Box2D.Collision.b2SeparationFunction;

  b2Simplex = Box2D.Collision.b2Simplex;

  b2SimplexCache = Box2D.Collision.b2SimplexCache;

  b2SimplexVertex = Box2D.Collision.b2SimplexVertex;

  b2TimeOfImpact = Box2D.Collision.b2TimeOfImpact;

  b2TOIInput = Box2D.Collision.b2TOIInput;

  b2WorldManifold = Box2D.Collision.b2WorldManifold;

  ClipVertex = Box2D.Collision.ClipVertex;

  Features = Box2D.Collision.Features;

  IBroadPhase = Box2D.Collision.IBroadPhase;

  b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;

  b2EdgeChainDef = Box2D.Collision.Shapes.b2EdgeChainDef;

  b2EdgeShape = Box2D.Collision.Shapes.b2EdgeShape;

  b2MassData = Box2D.Collision.Shapes.b2MassData;

  b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;

  b2Shape = Box2D.Collision.Shapes.b2Shape;

  b2Body = Box2D.Dynamics.b2Body;

  b2BodyDef = Box2D.Dynamics.b2BodyDef;

  b2ContactFilter = Box2D.Dynamics.b2ContactFilter;

  b2ContactImpulse = Box2D.Dynamics.b2ContactImpulse;

  b2ContactListener = Box2D.Dynamics.b2ContactListener;

  b2ContactManager = Box2D.Dynamics.b2ContactManager;

  b2DebugDraw = Box2D.Dynamics.b2DebugDraw;

  b2DestructionListener = Box2D.Dynamics.b2DestructionListener;

  b2FilterData = Box2D.Dynamics.b2FilterData;

  b2Fixture = Box2D.Dynamics.b2Fixture;

  b2FixtureDef = Box2D.Dynamics.b2FixtureDef;

  b2Island = Box2D.Dynamics.b2Island;

  b2TimeStep = Box2D.Dynamics.b2TimeStep;

  b2World = Box2D.Dynamics.b2World;

  b2CircleContact = Box2D.Dynamics.Contacts.b2CircleContact;

  b2Contact = Box2D.Dynamics.Contacts.b2Contact;

  b2ContactConstraint = Box2D.Dynamics.Contacts.b2ContactConstraint;

  b2ContactConstraintPoint = Box2D.Dynamics.Contacts.b2ContactConstraintPoint;

  b2ContactEdge = Box2D.Dynamics.Contacts.b2ContactEdge;

  b2ContactFactory = Box2D.Dynamics.Contacts.b2ContactFactory;

  b2ContactRegister = Box2D.Dynamics.Contacts.b2ContactRegister;

  b2ContactResult = Box2D.Dynamics.Contacts.b2ContactResult;

  b2ContactSolver = Box2D.Dynamics.Contacts.b2ContactSolver;

  b2EdgeAndCircleContact = Box2D.Dynamics.Contacts.b2EdgeAndCircleContact;

  b2NullContact = Box2D.Dynamics.Contacts.b2NullContact;

  b2PolyAndCircleContact = Box2D.Dynamics.Contacts.b2PolyAndCircleContact;

  b2PolyAndEdgeContact = Box2D.Dynamics.Contacts.b2PolyAndEdgeContact;

  b2PolygonContact = Box2D.Dynamics.Contacts.b2PolygonContact;

  b2PositionSolverManifold = Box2D.Dynamics.Contacts.b2PositionSolverManifold;

  b2Controller = Box2D.Dynamics.Controllers.b2Controller;

  b2DistanceJoint = Box2D.Dynamics.Joints.b2DistanceJoint;

  b2DistanceJointDef = Box2D.Dynamics.Joints.b2DistanceJointDef;

  b2FrictionJoint = Box2D.Dynamics.Joints.b2FrictionJoint;

  b2FrictionJointDef = Box2D.Dynamics.Joints.b2FrictionJointDef;

  b2GearJoint = Box2D.Dynamics.Joints.b2GearJoint;

  b2GearJointDef = Box2D.Dynamics.Joints.b2GearJointDef;

  b2Jacobian = Box2D.Dynamics.Joints.b2Jacobian;

  b2Joint = Box2D.Dynamics.Joints.b2Joint;

  b2JointDef = Box2D.Dynamics.Joints.b2JointDef;

  b2JointEdge = Box2D.Dynamics.Joints.b2JointEdge;

  b2LineJoint = Box2D.Dynamics.Joints.b2LineJoint;

  b2LineJointDef = Box2D.Dynamics.Joints.b2LineJointDef;

  b2MouseJoint = Box2D.Dynamics.Joints.b2MouseJoint;

  b2MouseJointDef = Box2D.Dynamics.Joints.b2MouseJointDef;

  b2PrismaticJoint = Box2D.Dynamics.Joints.b2PrismaticJoint;

  b2PrismaticJointDef = Box2D.Dynamics.Joints.b2PrismaticJointDef;

  b2PulleyJoint = Box2D.Dynamics.Joints.b2PulleyJoint;

  b2PulleyJointDef = Box2D.Dynamics.Joints.b2PulleyJointDef;

  b2RevoluteJoint = Box2D.Dynamics.Joints.b2RevoluteJoint;

  b2RevoluteJointDef = Box2D.Dynamics.Joints.b2RevoluteJointDef;

  b2WeldJoint = Box2D.Dynamics.Joints.b2WeldJoint;

  b2WeldJointDef = Box2D.Dynamics.Joints.b2WeldJointDef;

  console.log(Box2D);

  Box2D.Common.Math.b2Vec2.prototype.to = function(that) {
    var vec;
    vec = that.Copy();
    vec.Subtract(this);
    return vec;
  };

  Box2D.Common.Math.b2Vec2.prototype.multiply = function(scale) {
    this.x = this.x * scale;
    return this.y = this.y * scale;
  };

  Box2D.Common.Math.b2Vec2.prototype.divide = function(scale) {
    this.x = this.x / scale;
    return this.y = this.y / scale;
  };

  Box2D.Common.Math.b2Vec2.prototype.closer_to = function(that, n) {
    var t1;
    t1 = this.to(that);
    t1.Normalize();
    t1.Multiply(n);
    t1.Add(this);
    return t1;
  };

  Box2D.Common.Math.b2Vec2.prototype.angle = function() {
    return Math.atan2(this.y, this.x);
  };

  Box2D.Common.Math.b2Vec2.prototype.angle_between = function(vec) {
    return self.dot(vec) / (vec.Length * self.Length);
  };

  Box2D.Common.Math.b2Vec2.prototype.dot = function(vec) {
    return console.log("calculate dot product");
  };

  Box2D.Common.Math.b2Vec2.prototype.proj = function(vec) {
    return console.log("calculate projection vector");
  };

  Box2D.Common.Math.b2Vec2.prototype.cross = function(vec) {
    return console.log("calculate cross project");
  };

  Physics = (function() {

    Physics.prototype.world = null;

    Physics.prototype.fix_def = null;

    Physics.prototype.solid = null;

    Physics.prototype.visible = false;

    Physics.prototype.PTM = 16;

    function Physics() {
      var solid_def;
      this.fix_def = new b2FixtureDef;
      this.fix_def.density = 1.0;
      this.fix_def.friction = 0.5;
      this.fix_def.restitution = 0.2;
      this.create_world();
      this.setup_debug_draw();
      solid_def = new b2BodyDef();
      solid_def.position.Set(0, 0);
      this.solid = this.world.CreateBody(solid_def);
      this.solid.SetUserData('my_SOLID');
      this.setup_contact_listener();
    }

    Physics.prototype.setup_contact_listener = function() {
      var contact_listener,
        _this = this;
      contact_listener = new b2ContactListener;
      contact_listener.BeginContact = function(contact) {
        var a, b;
        a = contact.GetFixtureA().GetBody().GetUserData();
        b = contact.GetFixtureB().GetBody().GetUserData();
        if (a instanceof Entity && b instanceof Entity) {
          a.hit_hash[b] = a;
          return b.hit_hash[a] = b;
        }
      };
      contact_listener.EndContact = function(contact) {
        var a, b;
        a = contact.GetFixtureA().GetBody().GetUserData();
        b = contact.GetFixtureB().GetBody().GetUserData();
        if (a instanceof Entity && b instanceof Entity) {
          delete a.hit_hash[b];
          return delete b.hit_hash[a];
        }
      };
      return this.world.SetContactListener(contact_listener);
    };

    Physics.prototype.create_world = function() {
      return this.world = new b2World(new b2Vec2(0.0, 60.0), true);
    };

    Physics.prototype.setup_debug_draw = function() {
      var debugDraw;
      debugDraw = new b2DebugDraw();
      debugDraw.SetSprite(Game.context);
      debugDraw.SetDrawScale(this.PTM);
      debugDraw.SetFillAlpha(0.5);
      debugDraw.SetLineThickness(1.0);
      debugDraw.SetFlags(b2DebugDraw.e_shapeBit);
      return this.world.SetDebugDraw(debugDraw);
    };

    Physics.prototype.build_edges = function() {
      this.build_solid_line(0, 0, AppData.width, 0);
      this.build_solid_line(0, AppData.height, AppData.width, AppData.height);
      this.build_solid_line(0, 0, 0, AppData.height);
      return this.build_solid_line(AppData.width, 0, AppData.width, AppData.height);
    };

    Physics.prototype.build_solid_line = function(x1, y1, x2, y2) {
      this.fix_def.shape = new b2PolygonShape;
      this.fix_def.shape.SetAsEdge(new b2Vec2(x1 / this.PTM, y1 / this.PTM), new b2Vec2(x2 / this.PTM, y2 / this.PTM));
      return this.solid.CreateFixture(this.fix_def);
    };

    Physics.prototype.build_solid_box = function(x, y, w, h, rotation) {
      this.fix_def.shape = new b2PolygonShape;
      this.fix_def.shape.SetAsOrientedBox(w / this.PTM / 2, h / this.PTM / 2, new b2Vec2(x / this.PTM, y / this.PTM), -rotation / 180 * Math.PI);
      return this.solid.CreateFixture(this.fix_def);
    };

    Physics.prototype.build_solid_circle = function(x, y, r) {
      this.fix_def.shape = new b2CircleShape;
      this.fix_def.shape.SetRadius(r / this.PTM);
      console.log(this.fix_def.shape);
      this.fix_def.shape.m_p = new b2Vec2(x / this.PTM, y / this.PTM);
      return this.solid.CreateFixture(this.fix_def);
    };

    Physics.prototype.build_dynamic = function(x, y, w, h, r, physics) {
      var bd, body, fd, shape;
      if (physics.shape === 'circle') {
        shape = new b2CircleShape();
        shape.SetRadius(r / this.PTM);
      } else {
        shape = new b2PolygonShape();
        shape.SetAsBox(w / this.PTM / 2, h / this.PTM / 2);
      }
      fd = new b2FixtureDef();
      fd.shape = shape;
      fd.density = physics.density;
      fd.friction = physics.friction;
      fd.restitution = physics.restitution;
      bd = new b2BodyDef();
      bd.position.Set(x / this.PTM, y / this.PTM);
      if (physics.type === 'dynamic') {
        bd.type = b2Body.b2_dynamicBody;
      } else {
        bd.type = b2Body.b2_staticBody;
        fd.isSensor = true;
      }
      if (physics.solid === true) {
        fd.isSensor = false;
      }
      body = this.world.CreateBody(bd);
      body.CreateFixture(fd);
      return body;
    };

    Physics.prototype.draw = function(x, y) {
      if (this.visible) {
        Game.context.save();
        Game.context.translate(x, y);
        this.world.DrawDebugData();
        return Game.context.restore();
      }
    };

    return Physics;

  })();

  Sprite = (function() {

    Sprite.prototype.x = 0;

    Sprite.prototype.y = 0;

    Sprite.prototype.visible = true;

    Sprite.prototype.alpha = 1;

    Sprite.prototype.rotation = 0;

    Sprite.prototype.index = 1;

    Sprite.prototype.z = 0;

    Sprite.prototype.name = null;

    Sprite.prototype.w = void 0;

    Sprite.prototype.h = void 0;

    function Sprite(name, x, y) {
      if (name == null) {
        name = 'PlaceHolder';
      }
      if (x == null) {
        x = 0;
      }
      if (y == null) {
        y = 0;
      }
      this.name = name;
      this.x = x;
      this.y = y;
      this.w = Game.images[name].width;
      this.h = Game.images[name].height;
    }

    Sprite.prototype.draw = function() {
      var h, image, w, x, y;
      image = this._get_image();
      x = this.x - this.w / 2;
      y = this.y - this.h / 2;
      if (this.rotation === 0 && this.w === image.width && this.h === image.height) {
        return Game.context.drawImage(image, 0, 0, this.w, this.h, x, y, this.w, this.h);
      } else {
        w = image.width;
        h = image.height;
        Game.context.save();
        Game.context.translate(x + this.w / 2, y + this.h / 2);
        Game.context.rotate(-Math.PI / 180 * (this.rotation % 360));
        Game.context.scale(this.w / w, this.h / h);
        Game.context.translate(-this.w / 2, -this.h / 2);
        Game.context.drawImage(image, 0, 0, this.w, this.h);
        return Game.context.restore();
      }
    };

    Sprite.prototype._get_image = function() {
      var result;
      if (this.index !== 1) {
        result = Game.images[this.name + this.index];
      } else {
        result = Game.images[this.name];
      }
      if (!result) {
        console.log("" + name + " not found.");
        result = Game.images['PlaceHolder'];
      }
      return result;
    };

    return Sprite;

  })();

  Text = (function() {

    Text.prototype.x = 0;

    Text.prototype.y = 0;

    Text.prototype.visible = true;

    Text.prototype.scale_x = 1;

    Text.prototype.scale_y = 1;

    Text.prototype.alpha = 1;

    Text.prototype.rotation = 0;

    Text.prototype.index = 1;

    Text.prototype.align = 'center';

    Text.prototype.z = 0;

    Text.prototype.name = null;

    Text.prototype.font = 'Dosis';

    Text.prototype.font_size = 16;

    Text.prototype.font_style = "";

    Text.prototype.string = '';

    function Text(string, x, y) {
      if (string == null) {
        string = '';
      }
      if (x == null) {
        x = 0;
      }
      if (y == null) {
        y = 0;
      }
      this.string = string;
      this.x = x;
      this.y = y;
    }

    Text.prototype.draw = function(string, x, y) {
      if (string == null) {
        string = '';
      }
      if (x == null) {
        x = 0;
      }
      if (y == null) {
        y = 0;
      }
      this._update();
      if (this.rotation !== 0) {
        Game.context.save();
        Game.context.translate(this.x + get_width() / 2, this.y + this.get_height() / 2);
        Game.context.rotate(Math.PI / 180 * this.rotation);
        Game.context.fillText(this.string, -this.get_width() / 2, -this.get_height() / 2);
        return Game.context.restore();
      } else {
        return Game.context.fillText(this.string, this.x, this.y);
      }
    };

    Text.prototype.get_width = function() {
      this._update();
      return Game.context.measureText(this.string).width;
    };

    Text.prototype.get_height = function() {
      return this.font_size;
    };

    Text.prototype._update = function() {
      Game.context.font = this.font_style + " " + this.font_size + "px '" + this.font + "'";
      return Game.context.textAlign = this.align;
    };

    return Text;

  })();

  Array.prototype.remove = function(e) {
    var t, _ref;
    if ((t = this.indexOf(e)) > -1) {
      return ([].splice.apply(this, [t, t - t + 1].concat(_ref = [])), _ref);
    }
  };

  Array.prototype.diff = function(a) {
    return this.filter(function(i) {
      return !(a.indexOf(i) > -1);
    });
  };

  Array.prototype.copy = function() {
    return this.slice(0);
  };

  Math.sign = function(n) {
    return (n > 0 ? 1 : (n < 0 ? -1 : 0));
  };

  Array.prototype.unique = function() {
    return this.sort().filter(function(v, i, o) {
      if (i && v !== o[i - 1]) {
        return v;
      } else {
        return 0;
      }
    });
  };

  Array.prototype.deepToString = function() {
    var i, result, _i, _ref;
    result = "[";
    for (i = _i = 0, _ref = this.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
      if (Object.prototype.toString.call(this[i]) === "[object Array]") {
        result += this[i].deepToString();
      } else if (this[i]) {
        result += this[i];
      }
      if (i !== this.length - 1) {
        result += ",";
      }
    }
    return result + "]";
  };

  Audio.muted = false;

  Audio.prototype.go = function() {
    if (Audio.muted === false) {
      return this.play();
    }
  };

  World = (function() {

    World.prototype._entities = [];

    World.prototype._entities_to_destroy = [];

    World.prototype.x = 0;

    World.prototype.y = 0;

    World.prototype.pause = false;

    World.prototype.physics = null;

    World.prototype.art = null;

    World.prototype.background = null;

    World.prototype.current_level = '';

    World.prototype.current_level_n = -1;

    function World() {
      this.next_level = __bind(this.next_level, this);
      this.background = new Sprite('Background', AppData.width / 2, AppData.height / 2);
      if (AppData.physics) {
        this.physics = new Physics;
      }
      this.art = new Art(this);
    }

    World.prototype.next_level = function() {
      if (this.current_level_n === -1) {
        return console.log("Error: Level number not set, can't go to next");
      } else {
        return this.change_level(this.current_level, this.current_level_n + 1);
      }
    };

    World.prototype.change_level = function(name, index) {
      if (index == null) {
        index = 1;
      }
      this.destroy_all();
      return this.load_level(name, index);
    };

    World.prototype.load_level = function(name, index) {
      var dataobject, level, number, property, s, value, _ref, _results;
      if (index == null) {
        index = 1;
      }
      if (index !== 1) {
        name = name.replace(/\d/, "");
        name = name + index;
      }
      this.current_level = name;
      this.current_level_n = index;
      level = AppData.levels[name];
      if (level === void 0) {
        console.log("Error: " + name + " not found");
      }
      _ref = level.data;
      _results = [];
      for (number in _ref) {
        dataobject = _ref[number];
        s = this.spawn(dataobject.name, dataobject.x, dataobject.y);
        for (property in dataobject) {
          value = dataobject[property];
          s[property] = value;
        }
        if (dataobject.rotation) {
          s.set_rotation(dataobject.rotation);
        }
        if (dataobject.w) {
          s.set_w(dataobject.w);
        }
        if (dataobject.h) {
          _results.push(s.set_h(dataobject.h));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    World.prototype.reset = function() {
      this.destroy_all();
      return this.load_level(current_level);
    };

    World.prototype.destroy = function(entity) {
      return this._entities_to_destroy.push(entity);
    };

    World.prototype.destroy_all = function() {
      var e, _i, _len, _ref, _results;
      _ref = this._entities;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        e = _ref[_i];
        _results.push(e.destroy());
      }
      return _results;
    };

    World.prototype.all_entities = function() {
      return this._entities;
    };

    World.prototype.spawn = function(name, x, y) {
      var cl, entity;
      if (x == null) {
        x = 0;
      }
      if (y == null) {
        y = 0;
      }
      cl = AppData.entities[name];
      if (cl === void 0 || !cl instanceof Entity) {
        console.log("Error: " + name + " not found");
      }
      entity = new cl;
      entity.world = this;
      entity.sx = x;
      entity.sy = y;
      if (entity.name === null) {
        entity.name = name;
      }
      if (entity.sprite === null) {
        if (!Game.images[name]) {
          name = 'PlaceHolder';
        }
        entity.sprite = new Sprite(name);
      }
      if (entity.w === void 0) {
        entity.w = entity.sprite.w;
      }
      if (entity.h === void 0) {
        entity.h = entity.sprite.h;
      }
      if (entity.r === void 0) {
        entity.r = (entity.w + entity.h) / 4;
      }
      entity.art = this.art;
      if (AppData.physics) {
        if (entity.physics) {
          entity.body = this.physics.build_dynamic(x, y, entity.w, entity.h, entity.r, entity.physics);
          entity.body.SetUserData(entity);
        }
      }
      this._entities.push(entity);
      entity.reset();
      entity.init();
      return entity;
    };

    World.prototype.entities_of_class = function(c) {
      var entity, res, _i, _len, _ref;
      res = [];
      _ref = this._entities;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        entity = _ref[_i];
        if (entity.name === c) {
          res.push(entity);
        }
      }
      return res;
    };

    World.prototype.number_of = function(c) {
      return this.entities_of_class(c).length;
    };

    World.prototype.exists = function(c) {
      return this.number_of(c) > 0;
    };

    World.prototype.draw = function() {
      var entity, _i, _len, _ref, _results;
      this.art.color('#EFF8FB');
      this.art.rectangleC(0, 0, AppData.width * AppData.scale / Game.zoom_level, AppData.height * AppData.scale / Game.zoom_level, true);
      this.art.color('#000000');
      this.background.draw();
      if (this.physics) {
        this.physics.draw(this.x, this.y);
      }
      this._entities.sort(function(a, b) {
        if (Math.sign(a.z - b.z) === 0) {
          return Math.sign(a.y - b.y);
        } else {
          return Math.sign(a.z - b.z);
        }
      });
      _ref = this._entities;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        entity = _ref[_i];
        _results.push(entity.draw());
      }
      return _results;
    };

    World.prototype.step = function() {
      var entity, _i, _len, _ref;
      Keyboard.step();
      if (this.pause === false) {
        this.physics.world.Step(1 / 120, 3, 2);
        _ref = this._entities;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          entity = _ref[_i];
          if (typeof entity.step === "function") {
            entity.step();
          }
        }
      }
      return this._remove_destroyed();
    };

    World.prototype._remove_destroyed = function() {
      var e, _i, _len, _ref;
      _ref = this._entities_to_destroy;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        e = _ref[_i];
        this._entities.remove(e);
      }
      return this._entities_to_destroy = [];
    };

    return World;

  })();

  Announcer = (function(_super) {

    __extends(Announcer, _super);

    function Announcer() {
      return Announcer.__super__.constructor.apply(this, arguments);
    }

    Announcer.prototype.default_persistance = 60;

    Announcer.prototype.z = 2000;

    Announcer.prototype.time = 0;

    Announcer.prototype.txt = null;

    Announcer.prototype.callback = null;

    Announcer.prototype.init = function() {
      this.x = AppData.width / 2;
      this.y = AppData.height / 2;
      this.txt = new Text('', this.x, this.y);
      this.txt.align = 'center';
      this.txt.font = 'Norwester';
      return this.txt.font_size = 72;
    };

    Announcer.prototype.say = function(string, persistance, callback) {
      if (persistance == null) {
        persistance = 0;
      }
      if (callback == null) {
        callback = null;
      }
      this.txt.string = string;
      if (persistance === 0) {
        persistance = this.default_persistance;
      }
      this.time = persistance;
      return this.callback = callback;
    };

    Announcer.prototype.step = function() {
      if (this.time > 0) {
        this.time -= 1;
        if (this.time === 0) {
          return this.callback();
        }
      }
    };

    Announcer.prototype.draw = function() {
      if (this.time > 0) {
        return this.txt.draw();
      }
    };

    return Announcer;

  })(Entity);

  Block = (function(_super) {

    __extends(Block, _super);

    function Block() {
      return Block.__super__.constructor.apply(this, arguments);
    }

    Block.prototype.physics = {
      friction: 0.25,
      solid: true
    };

    return Block;

  })(Entity);

  Bullet = (function(_super) {

    __extends(Bullet, _super);

    function Bullet() {
      return Bullet.__super__.constructor.apply(this, arguments);
    }

    Bullet.prototype.direction = 0;

    Bullet.prototype.speed = 10;

    Bullet.prototype.step = function() {
      this.x += Math.cos(this.direction / 180 * Math.PI) * this.speed;
      return this.y -= Math.sin(this.direction / 180 * Math.PI) * this.speed;
    };

    return Bullet;

  })(Entity);

  Button = (function(_super) {

    __extends(Button, _super);

    function Button() {
      return Button.__super__.constructor.apply(this, arguments);
    }

    Button.text = null;

    Button.prototype.draw = function() {
      Button.__super__.draw.call(this);
      this.text.x = this.x;
      this.text.y = this.y;
      return this.text.draw();
    };

    return Button;

  })(Entity);

  Fly = (function(_super) {

    __extends(Fly, _super);

    function Fly() {
      return Fly.__super__.constructor.apply(this, arguments);
    }

    Fly.prototype.physics = {
      shape: 'circle'
    };

    Fly.prototype.flare = null;

    Fly.prototype.init = function() {
      return this.flare = new Sprite('Flare', this.x, this.y);
    };

    Fly.prototype.draw = function() {
      Fly.__super__.draw.call(this);
      return this.flare.draw();
    };

    return Fly;

  })(Entity);

  GameController = (function(_super) {

    __extends(GameController, _super);

    function GameController() {
      this.win = __bind(this.win, this);
      return GameController.__super__.constructor.apply(this, arguments);
    }

    GameController.score = 0;

    GameController.prototype.text = null;

    GameController.prototype.world = null;

    GameController.prototype.date = 0;

    GameController.prototype.announcer = null;

    GameController.prototype.won = false;

    GameController.prototype.init = function() {
      this.announcer = this.world.spawn('Announcer');
      this.text = new Text('10', 10, 10);
      return this.text.align = 'left';
    };

    GameController.prototype.step = function() {
      if (Keyboard.press('ESCAPE')) {
        this.world.change_level('Menu');
      }
      if (!this.hero) {
        this.hero = this.world.entities_of_class('Spider')[0];
      }
      if (this.hero) {
        if (this.hero.touch('Fly')) {
          return this.win();
        }
      }
    };

    GameController.prototype.win = function() {
      if (!this.won) {
        this.won = true;
        console.log('won');
        return this.announcer.say('Well Done!', 140, this.world.next_level);
      }
    };

    GameController.prototype.draw = function() {
      var sec, tmp_date;
      tmp_date = new Date;
      sec = tmp_date - this.date;
      this.date = tmp_date;
      this.text.string = sec;
      return this.text.draw();
    };

    return GameController;

  })(Entity);

  Menu_1D = (function(_super) {

    __extends(Menu_1D, _super);

    function Menu_1D() {
      return Menu_1D.__super__.constructor.apply(this, arguments);
    }

    Menu_1D.prototype.index = 0;

    Menu_1D.prototype.button_n = 2;

    Menu_1D.prototype.texts = [];

    Menu_1D.prototype.button_space = 50;

    Menu_1D.prototype.marker = null;

    Menu_1D.prototype.spider = null;

    Menu_1D.prototype.init = function() {
      var i, t, _i, _ref, _results;
      this.x = 50;
      this.y = 300;
      this.marker = new Sprite('Marker');
      this.spider = new Sprite('Spider_Menu', 450, 350);
      this.title = new Text('Itsy Bitsy', AppData.width / 2, 20);
      this.credit = new Text('By Jens Dahl Mollerhoj', AppData.width / 2, 140);
      this.credit.font_size = 20;
      this.credit.font = 'Norwester';
      this.title.font_size = 120;
      this.title.font = 'Norwester';
      this.texts[0] = new Text('Play');
      this.texts[1] = new Text('Options');
      _results = [];
      for (i = _i = 0, _ref = this.button_n; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        t = this.texts[i];
        if (t) {
          t.align = 'left';
          t.font = 'Norwester';
          t.font_size = 30;
          t.y = this.y + i * this.button_space;
          _results.push(t.x = this.x);
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    Menu_1D.prototype.step = function() {
      if (Keyboard.press('DOWN')) {
        this.index += 1;
      }
      if (Keyboard.press('UP')) {
        this.index -= 1;
      }
      if (Keyboard.press('SPACE')) {
        if (this.index === 0) {
          this.destroy();
          this.spawn('Menu_2D');
        }
      }
      if (this.index < 0) {
        this.index = 0;
      }
      if (this.index > this.button_n - 1) {
        return this.index = this.button_n - 1;
      }
    };

    Menu_1D.prototype.draw = function() {
      var text, _i, _len, _ref, _results;
      this.marker.y = this.y + this.index * this.button_space;
      this.marker.x = this.x + this.marker.w / 4;
      this.marker.rotation += 1;
      this.marker.draw();
      this.credit.draw();
      this.spider.draw();
      this.title.draw();
      _ref = this.texts;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        text = _ref[_i];
        _results.push(text.draw());
      }
      return _results;
    };

    return Menu_1D;

  })(Entity);

  Menu_2D = (function(_super) {

    __extends(Menu_2D, _super);

    function Menu_2D() {
      return Menu_2D.__super__.constructor.apply(this, arguments);
    }

    Menu_2D.prototype.index_x = -1;

    Menu_2D.prototype.index_y = 0;

    Menu_2D.prototype.button_n = 14;

    Menu_2D.prototype.buttons = [];

    Menu_2D.prototype.cols = 4;

    Menu_2D.prototype.button_x_space = 100;

    Menu_2D.prototype.button_y_space = 50;

    Menu_2D.prototype.marker = null;

    Menu_2D.prototype.headline = "Select Level";

    Menu_2D.prototype.heading = null;

    Menu_2D.prototype.heading_x = 320;

    Menu_2D.prototype.heading_y = 220;

    Menu_2D.prototype.init = function() {
      var b, i, _i, _j, _ref, _ref1, _results;
      this.x = 160;
      this.y = 300;
      this.marker = new Sprite('Marker');
      this.heading = new Text(this.headline, this.heading_x, this.heading_y);
      this.heading.align = 'center';
      this.heading.font = 'Norwester';
      this.heading.font_size = 60;
      b = this.world.spawn('Button');
      b.x = this.x - this.button_x_space;
      b.y = this.y;
      b.text = new Text('Back');
      this.buttons[0] = b;
      for (i = _i = 1, _ref = this.button_n; 1 <= _ref ? _i <= _ref : _i >= _ref; i = 1 <= _ref ? ++_i : --_i) {
        b = this.world.spawn('Button');
        b.text = new Text("Level " + i);
        this.buttons[i] = b;
      }
      _results = [];
      for (i = _j = 1, _ref1 = this.button_n; 1 <= _ref1 ? _j <= _ref1 : _j >= _ref1; i = 1 <= _ref1 ? ++_j : --_j) {
        b = this.buttons[i];
        if (b) {
          b.text.align = 'center';
          b.text.font = 'Norwester';
          b.y = this.y + Math.floor((i - 1) / this.cols) * this.button_y_space;
          _results.push(b.x = this.x + ((i - 1) % this.cols) * this.button_x_space);
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    Menu_2D.prototype.space = function() {
      if (this.index_x === -1) {
        this.destroy();
        return this.spawn('Menu_1D');
      } else {
        return this.goto_level(1 + this.index_y * this.cols + this.index_x);
      }
    };

    Menu_2D.prototype.goto_level = function(lvl) {
      this.world.destroy_all();
      return this.world.load_level("Level", lvl);
    };

    Menu_2D.prototype.step = function() {
      if (Keyboard.press('SPACE')) {
        this.space();
      }
      if (Keyboard.press('DOWN')) {
        this.index_y += 1;
      }
      if (Keyboard.press('UP')) {
        this.index_y -= 1;
      }
      if (Keyboard.press('RIGHT')) {
        this.index_x += 1;
      }
      if (Keyboard.press('LEFT')) {
        this.index_x -= 1;
      }
      if (this.index_x < 0) {
        this.index_y = 0;
      }
      if (this.index_x < -1) {
        this.index_x = -1;
      }
      if (this.index_y < 0) {
        this.index_y = 0;
      }
      if (this.index_y > Math.floor(this.button_n / this.cols)) {
        this.index_y = Math.floor(this.button_n / this.cols);
      }
      if (this.index_x > this.cols - 1) {
        return this.index_x = this.cols - 1;
      }
    };

    Menu_2D.prototype.draw = function() {
      this.marker.y = this.y + this.index_y * this.button_y_space;
      this.marker.x = this.x + this.index_x * this.button_x_space + this.marker.w / 4;
      this.marker.draw();
      this.heading.string = this.headline;
      return this.heading.draw();
    };

    return Menu_2D;

  })(Entity);

  Spider = (function(_super) {

    __extends(Spider, _super);

    function Spider() {
      return Spider.__super__.constructor.apply(this, arguments);
    }

    Spider.prototype.physics = {
      shape: 'circle',
      friction: 0.25,
      density: 15,
      restitution: 0.95,
      type: 'dynamic'
    };

    Spider.prototype.body = null;

    Spider.prototype.r = 5;

    Spider.prototype.speed = 2;

    Spider.prototype.jump_power = 800;

    Spider.prototype.crawl_speed = 0.1;

    Spider.prototype.aim = 30;

    Spider.prototype.aim2 = 90;

    Spider.prototype.rope = [];

    Spider.prototype.rope_precision = 4;

    Spider.prototype.joint = null;

    Spider.prototype.bullet = null;

    Spider.prototype.init = function() {
      this.joint_last_angle = this.rotation + 90;
      this.rope = [];
      return this.shoot_bullet();
    };

    Spider.prototype.calculate_aim2 = function() {
      var dir, vec;
      vec = this.joint.GetAnchorB().Copy();
      vec.Subtract(this.joint.GetAnchorA());
      dir = vec.angle() / (Math.PI * 2) * 360;
      dir = (dir + 360) % 360;
      if (dir < this.aim) {
        dir = this.aim;
      } else if (dir > 270) {
        dir = this.aim;
      } else if (dir > 180 - this.aim) {
        dir = 180 - this.aim;
      }
      return this.aim2 = dir;
    };

    Spider.prototype.dis_joint = function(p) {
      var jointDef;
      p = p.Copy();
      p.divide(16);
      jointDef = new b2DistanceJointDef();
      jointDef.Initialize(this.world.physics.solid, this.body, p, this.body.GetWorldCenter());
      jointDef.collideConnected = true;
      return this.joint = this.world.physics.world.CreateJoint(jointDef);
    };

    Spider.prototype.dis_joint_off = function() {
      this.calculate_aim2();
      this.world.physics.world.DestroyJoint(this.joint);
      return this.joint = null;
    };

    Spider.prototype.ray_shoot = function(p) {
      var b, f, input, output, x2, y2;
      input = new b2RayCastInput(new b2Vec2(this.x / 16, this.y / 16), new b2Vec2(p.x / 16, p.y / 16));
      output = new b2RayCastOutput();
      b = this.world.physics.world.GetBodyList();
      while (b) {
        f = b.GetFixtureList();
        while (f) {
          if (f.GetType()) {
            if (f.RayCast(output, input, b.GetTransform())) {
              p = input.p1.to(input.p2);
              x2 = this.x + p.x * 16 * output.fraction;
              y2 = this.y + p.y * 16 * output.fraction;
              return new b2Vec2(x2, y2);
            }
          }
          f = f.GetNext();
        }
        b = b.GetNext();
      }
    };

    Spider.prototype.triangle_check = function(p1, p2, p3) {
      var b, center, f;
      b = this.world.physics.world.GetBodyList();
      while (b) {
        f = b.GetFixtureList();
        while (f) {
          center = f.GetShape().m_centroid;
          if (center) {
            if (this.in_triangle(new b2Vec2(center.x * 16, center.y * 16), p1, p2, p3)) {
              return true;
            }
          }
          f = f.GetNext();
        }
        b = b.GetNext();
      }
      return false;
    };

    Spider.prototype.in_triangle = function(p, p1, p2, p3) {
      var alpha, beta, gamma;
      alpha = ((p2.y - p3.y) * (p.x - p3.x) + (p3.x - p2.x) * (p.y - p3.y)) / ((p2.y - p3.y) * (p1.x - p3.x) + (p3.x - p2.x) * (p1.y - p3.y));
      beta = ((p3.y - p1.y) * (p.x - p3.x) + (p1.x - p3.x) * (p.y - p3.y)) / ((p2.y - p3.y) * (p1.x - p3.x) + (p3.x - p2.x) * (p1.y - p3.y));
      gamma = 1 - alpha - beta;
      return alpha > 0 && beta > 0 && gamma > 0;
    };

    Spider.prototype.shoot_bullet = function() {
      if (!this.bullet && !this.joint) {
        this.bullet = this.spawn('Bullet', this.x, this.y);
        return this.bullet.direction = this.aim2;
      }
    };

    Spider.prototype.step = function() {
      var hit, t0, t1, t2;
      if (hit = this.touch('Fly')) {
        hit.destroy();
      }
      if (Keyboard.press('SPACE')) {
        if (!this.bullet) {
          if (this.joint) {
            this.dis_joint_off();
            this.rope = [];
          }
        }
        if (this.bullet) {
          this.bullet.destroy();
          this.bullet = null;
          this.rope.length = 1;
        }
      }
      if (Keyboard.release('SPACE')) {
        this.shoot_bullet();
      }
      if (this.joint) {
        if (Keyboard.hold('LEFT')) {
          this.body.ApplyImpulse(new b2Vec2(-this.speed, 0), this.body.GetWorldCenter());
        }
        if (Keyboard.hold('RIGHT')) {
          this.body.ApplyImpulse(new b2Vec2(this.speed, 0), this.body.GetWorldCenter());
        }
        if (Keyboard.hold('DOWN')) {
          this.joint.SetLength(this.joint.GetLength() + this.crawl_speed);
        }
        if (Keyboard.hold('UP')) {
          if (this.joint.GetLength() > 0.3) {
            this.joint.SetLength(this.joint.GetLength() - this.crawl_speed);
          }
        }
      }
      Spider.__super__.step.call(this);
      if (Keyboard.press('F')) {
        console.log(this.bullet, this.joint, this.rope);
      }
      if (this.bullet) {
        this.rope[0] = new b2Vec2(this.bullet.x, this.bullet.y);
        this.rope.length = 2;
        if (hit = this.ray_shoot(this.rope[0])) {
          this.bullet.destroy();
          this.bullet = null;
          this.dis_joint(hit);
          this.rope[0] = new b2Vec2(hit.x, hit.y);
        }
      }
      if (this.joint) {
        t0 = new b2Vec2(this.x, this.y);
        t1 = this.rope[this.rope.length - 2].closer_to(t0, this.rope_precision);
        if (hit = this.ray_shoot(t1)) {
          this.rope[this.rope.length - 1] = hit;
          this.rope.length += 1;
          this.world.physics.world.DestroyJoint(this.joint);
          this.joint = null;
          this.dis_joint(hit);
        }
        if (this.rope.length > 2) {
          t2 = this.rope[this.rope.length - 3].closer_to(t0, this.rope_precision);
          if (!(hit = this.ray_shoot(t2))) {
            if (!this.triangle_check(t0, t1, t2)) {
              this.rope.pop();
              this.world.physics.world.DestroyJoint(this.joint);
              this.joint = null;
              return this.dis_joint(this.rope[this.rope.length - 2]);
            }
          }
        }
      }
    };

    Spider.prototype.draw = function() {
      var i, knot, pknot, vec, _i, _ref, _results;
      if (this.joint) {
        vec = this.joint.GetAnchorB().Copy();
        vec.Subtract(this.joint.GetAnchorA());
        this.rotation = 90 - vec.angle() / (Math.PI * 2) * 360;
      } else {
        this.rotation = this.aim2 - 90;
      }
      Spider.__super__.draw.call(this);
      this.rope[this.rope.length - 1] = new b2Vec2(this.x, this.y);
      _results = [];
      for (i = _i = 0, _ref = this.rope.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
        knot = this.rope[i];
        if (knot) {
          if (i > 0) {
            this.art.line(pknot.x, pknot.y, knot.x, knot.y);
          }
          _results.push(pknot = knot);
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    Spider.prototype.destroy = function() {
      if (this.joint) {
        this.world.physics.world.DestroyJoint(this.joint);
      }
      if (this.bullet) {
        this.bullet.destroy();
      }
      return Spider.__super__.destroy.call(this);
    };

    return Spider;

  })(Entity);

  Web = (function(_super) {

    __extends(Web, _super);

    function Web() {
      return Web.__super__.constructor.apply(this, arguments);
    }

    return Web;

  })(Entity);

  Level = (function() {

    function Level() {}

    Level.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      },
      2: {
        name: 'Block',
        x: 324,
        y: 139,
        rotation: -1,
        w: 209,
        h: 32
      },
      3: {
        name: 'Web',
        x: 225,
        y: 146,
        rotation: -11,
        w: 83,
        h: 39
      },
      4: {
        name: 'Block',
        x: 130,
        y: 154,
        rotation: 10,
        w: 209,
        h: 32
      },
      5: {
        name: 'Block',
        x: 501,
        y: 165,
        rotation: -19,
        w: 209,
        h: 32
      },
      6: {
        name: 'Web',
        x: 569,
        y: 220,
        rotation: -70,
        w: 83,
        h: 39
      },
      7: {
        name: 'Fly',
        x: 135,
        y: 256,
        rotation: 0,
        w: 16,
        h: 8
      },
      8: {
        name: 'Block',
        x: 588,
        y: 262,
        rotation: 87,
        w: 209,
        h: 32
      },
      9: {
        name: 'Block',
        x: 47,
        y: 266,
        rotation: -87,
        w: 209,
        h: 32
      },
      10: {
        name: 'Spider',
        x: 536,
        y: 338,
        rotation: 0,
        w: 24,
        h: 21
      },
      11: {
        name: 'Web',
        x: 87,
        y: 347,
        rotation: -28,
        w: 86,
        h: 39
      },
      12: {
        name: 'Block',
        x: 144,
        y: 362,
        rotation: -9,
        w: 209,
        h: 32
      },
      13: {
        name: 'Block',
        x: 304,
        y: 372,
        rotation: 2,
        w: 209,
        h: 32
      },
      14: {
        name: 'Block',
        x: 492,
        y: 374,
        rotation: -3,
        w: 209,
        h: 32
      }
    };

    return Level;

  })();

  Level10 = (function() {

    function Level10() {}

    Level10.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      }
    };

    return Level10;

  })();

  Level11 = (function() {

    function Level11() {}

    Level11.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      }
    };

    return Level11;

  })();

  Level2 = (function() {

    function Level2() {}

    Level2.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      },
      2: {
        name: 'Block',
        x: 331,
        y: 75,
        rotation: 0,
        w: 209,
        h: 32
      },
      3: {
        name: 'Block',
        x: 140,
        y: 79,
        rotation: 5,
        w: 209,
        h: 32
      },
      4: {
        name: 'Block',
        x: 506,
        y: 96,
        rotation: -12,
        w: 209,
        h: 32
      },
      5: {
        name: 'Web',
        x: 574,
        y: 132,
        rotation: -74,
        w: 67,
        h: 39
      },
      6: {
        name: 'Block',
        x: 54,
        y: 180,
        rotation: -87,
        w: 209,
        h: 32
      },
      7: {
        name: 'Block',
        x: 594,
        y: 207,
        rotation: -90,
        w: 209,
        h: 32
      },
      8: {
        name: 'Spider',
        x: 100,
        y: 224,
        rotation: 0,
        w: 24,
        h: 21
      },
      9: {
        name: 'Block',
        x: 336,
        y: 266,
        rotation: 5,
        w: 209,
        h: 32
      },
      10: {
        name: 'Block',
        x: 176,
        y: 266,
        rotation: -3,
        w: 209,
        h: 32
      },
      11: {
        name: 'Block',
        x: 47,
        y: 344,
        rotation: -98,
        w: 209,
        h: 32
      },
      12: {
        name: 'Block',
        x: 520,
        y: 355,
        rotation: 38,
        w: 209,
        h: 32
      },
      13: {
        name: 'Fly',
        x: 108,
        y: 359,
        rotation: 0,
        w: 16,
        h: 8
      },
      14: {
        name: 'Web',
        x: 76,
        y: 417,
        rotation: 147,
        w: 83,
        h: 39
      },
      15: {
        name: 'Block',
        x: 344,
        y: 434,
        rotation: 10,
        w: 209,
        h: 32
      },
      16: {
        name: 'Block',
        x: 147,
        y: 440,
        rotation: -6,
        w: 209,
        h: 32
      }
    };

    return Level2;

  })();

  Level3 = (function() {

    function Level3() {}

    Level3.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      },
      2: {
        name: 'Block',
        x: 314,
        y: 88,
        rotation: 0,
        w: 209,
        h: 32
      },
      3: {
        name: 'Block',
        x: 128,
        y: 107,
        rotation: 15,
        w: 209,
        h: 32
      },
      4: {
        name: 'Block',
        x: 487,
        y: 137,
        rotation: -38,
        w: 209,
        h: 32
      },
      5: {
        name: 'Fly',
        x: 475,
        y: 192,
        rotation: 0,
        w: 16,
        h: 8
      },
      6: {
        name: 'Web',
        x: 551,
        y: 212,
        rotation: 124,
        w: 83,
        h: 39
      },
      7: {
        name: 'Block',
        x: 46,
        y: 238,
        rotation: -92,
        w: 209,
        h: 32
      },
      8: {
        name: 'Block',
        x: 469,
        y: 247,
        rotation: 8,
        w: 209,
        h: 32
      },
      9: {
        name: 'Block',
        x: 316,
        y: 260,
        rotation: 0,
        w: 209,
        h: 32
      },
      10: {
        name: 'Block',
        x: 579,
        y: 288,
        rotation: -77,
        w: 209,
        h: 32
      },
      11: {
        name: 'Spider',
        x: 527,
        y: 327,
        rotation: 0,
        w: 24,
        h: 21
      },
      12: {
        name: 'Block',
        x: 50,
        y: 353,
        rotation: -80,
        w: 209,
        h: 32
      },
      13: {
        name: 'Web',
        x: 80,
        y: 384,
        rotation: 123,
        w: 83,
        h: 39
      },
      14: {
        name: 'Web',
        x: 85,
        y: 399,
        rotation: 0,
        w: 83,
        h: 39
      },
      15: {
        name: 'Block',
        x: 510,
        y: 404,
        rotation: 4,
        w: 209,
        h: 32
      },
      16: {
        name: 'Web',
        x: 73,
        y: 406,
        rotation: -167,
        w: 83,
        h: 39
      },
      17: {
        name: 'Block',
        x: 338,
        y: 415,
        rotation: 0,
        w: 209,
        h: 32
      },
      18: {
        name: 'Block',
        x: 136,
        y: 415,
        rotation: 0,
        w: 209,
        h: 32
      }
    };

    return Level3;

  })();

  Level4 = (function() {

    function Level4() {}

    Level4.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      },
      2: {
        name: 'Block',
        x: 501,
        y: 51,
        rotation: -19,
        w: 209,
        h: 32
      },
      3: {
        name: 'Block',
        x: 377,
        y: 95,
        rotation: 60,
        w: 209,
        h: 32
      },
      4: {
        name: 'Fly',
        x: 470,
        y: 132,
        rotation: 0,
        w: 16,
        h: 8
      },
      5: {
        name: 'Block',
        x: 559,
        y: 162,
        rotation: 71,
        w: 209,
        h: 32
      },
      6: {
        name: 'Block',
        x: 248,
        y: 209,
        rotation: 23,
        w: 209,
        h: 32
      },
      7: {
        name: 'Block',
        x: 113,
        y: 244,
        rotation: -7,
        w: 209,
        h: 32
      },
      8: {
        name: 'Block',
        x: 458,
        y: 309,
        rotation: 42,
        w: 209,
        h: 32
      },
      9: {
        name: 'Block',
        x: 30,
        y: 321,
        rotation: 93,
        w: 209,
        h: 32
      },
      10: {
        name: 'Spider',
        x: 110,
        y: 314,
        rotation: 0,
        w: 24,
        h: 21
      },
      11: {
        name: 'Block',
        x: 290,
        y: 392,
        rotation: 13,
        w: 209,
        h: 32
      },
      12: {
        name: 'Block',
        x: 124,
        y: 414,
        rotation: -2,
        w: 209,
        h: 32
      }
    };

    return Level4;

  })();

  Level5 = (function() {

    function Level5() {}

    Level5.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      },
      2: {
        name: 'Block',
        x: 332,
        y: 166,
        rotation: -4,
        w: 209,
        h: 32
      },
      3: {
        name: 'Block',
        x: 137,
        y: 194,
        rotation: 20,
        w: 209,
        h: 32
      },
      4: {
        name: 'Block',
        x: 530,
        y: 204,
        rotation: -18,
        w: 209,
        h: 32
      },
      5: {
        name: 'Fly',
        x: 533,
        y: 272,
        rotation: 0,
        w: 16,
        h: 8
      },
      6: {
        name: 'Block',
        x: 573,
        y: 319,
        rotation: -115,
        w: 209,
        h: 32
      },
      7: {
        name: 'Block',
        x: 57,
        y: 322,
        rotation: -86,
        w: 209,
        h: 32
      },
      8: {
        name: 'Bullet',
        x: 106,
        y: 357,
        rotation: 0,
        w: 4,
        h: 4
      },
      9: {
        name: 'Spider',
        x: 106,
        y: 357,
        rotation: 0,
        w: 24,
        h: 21
      },
      10: {
        name: 'Block',
        x: 441,
        y: 396,
        rotation: -8,
        w: 209,
        h: 32
      },
      11: {
        name: 'Block',
        x: 152,
        y: 403,
        rotation: 10,
        w: 209,
        h: 32
      },
      12: {
        name: 'Block',
        x: 378,
        y: 470,
        rotation: -69,
        w: 209,
        h: 32
      },
      13: {
        name: 'Block',
        x: 227,
        y: 478,
        rotation: 81,
        w: 209,
        h: 32
      },
      14: {
        name: 'Announcer',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      }
    };

    return Level5;

  })();

  Level6 = (function() {

    function Level6() {}

    Level6.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      },
      2: {
        name: 'Block',
        x: 258,
        y: 94,
        rotation: -91,
        w: 209,
        h: 32
      },
      3: {
        name: 'Block',
        x: 598,
        y: 104,
        rotation: 85,
        w: 209,
        h: 32
      },
      4: {
        name: 'Block',
        x: 257,
        y: 195,
        rotation: -90,
        w: 209,
        h: 32
      },
      5: {
        name: 'Block',
        x: 419,
        y: 233,
        rotation: -86,
        w: 209,
        h: 32
      },
      6: {
        name: 'Block',
        x: 169,
        y: 282,
        rotation: -5,
        w: 209,
        h: 32
      },
      7: {
        name: 'Block',
        x: 594,
        y: 293,
        rotation: -87,
        w: 209,
        h: 32
      },
      8: {
        name: 'Block',
        x: 421,
        y: 321,
        rotation: -89,
        w: 209,
        h: 32
      },
      9: {
        name: 'Fly',
        x: 515,
        y: 350,
        rotation: 0,
        w: 16,
        h: 8
      },
      10: {
        name: 'Block',
        x: 62,
        y: 355,
        rotation: -101,
        w: 209,
        h: 32
      },
      11: {
        name: 'Spider',
        x: 131,
        y: 363,
        rotation: 0,
        w: 24,
        h: 21
      },
      12: {
        name: 'Bullet',
        x: 131,
        y: 363,
        rotation: 0,
        w: 4,
        h: 4
      },
      13: {
        name: 'Block',
        x: 512,
        y: 404,
        rotation: 6,
        w: 209,
        h: 32
      },
      14: {
        name: 'Block',
        x: 337,
        y: 413,
        rotation: 2,
        w: 209,
        h: 32
      },
      15: {
        name: 'Block',
        x: 145,
        y: 426,
        rotation: 6,
        w: 209,
        h: 32
      },
      16: {
        name: 'Announcer',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      }
    };

    return Level6;

  })();

  Level7 = (function() {

    function Level7() {}

    Level7.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      },
      2: {
        name: 'Block',
        x: 582,
        y: 51,
        rotation: 45,
        w: 209,
        h: 32
      },
      3: {
        name: 'Block',
        x: 56,
        y: 61,
        rotation: -47,
        w: 209,
        h: 32
      },
      4: {
        name: 'Block',
        x: 134,
        y: 142,
        rotation: -46,
        w: 209,
        h: 32
      },
      5: {
        name: 'Block',
        x: 485,
        y: 143,
        rotation: 43,
        w: 209,
        h: 32
      },
      6: {
        name: 'Block',
        x: 501,
        y: 194,
        rotation: 13,
        w: 209,
        h: 32
      },
      7: {
        name: 'Block',
        x: 114,
        y: 195,
        rotation: -14,
        w: 209,
        h: 32
      },
      8: {
        name: 'Block',
        x: 600,
        y: 259,
        rotation: -92,
        w: 209,
        h: 32
      },
      9: {
        name: 'Block',
        x: 24,
        y: 266,
        rotation: -87,
        w: 209,
        h: 32
      },
      10: {
        name: 'Fly',
        x: 523,
        y: 274,
        rotation: 0,
        w: 16,
        h: 8
      },
      11: {
        name: 'Spider',
        x: 83,
        y: 293,
        rotation: 0,
        w: 24,
        h: 21
      },
      12: {
        name: 'Bullet',
        x: 83,
        y: 293,
        rotation: 0,
        w: 4,
        h: 4
      },
      13: {
        name: 'Block',
        x: 504,
        y: 343,
        rotation: 0,
        w: 209,
        h: 32
      },
      14: {
        name: 'Block',
        x: 118,
        y: 349,
        rotation: 3,
        w: 209,
        h: 32
      },
      15: {
        name: 'Block',
        x: 419,
        y: 437,
        rotation: -87,
        w: 209,
        h: 32
      },
      16: {
        name: 'Block',
        x: 203,
        y: 437,
        rotation: 88,
        w: 209,
        h: 32
      },
      17: {
        name: 'Announcer',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      }
    };

    return Level7;

  })();

  Level8 = (function() {

    function Level8() {}

    Level8.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      },
      2: {
        name: 'Block',
        x: 284,
        y: 79,
        rotation: 12,
        w: 209,
        h: 32
      },
      3: {
        name: 'Fly',
        x: 134,
        y: 199,
        rotation: 0,
        w: 16,
        h: 8
      },
      4: {
        name: 'Block',
        x: 322,
        y: 254,
        rotation: 4,
        w: 209,
        h: 32
      },
      5: {
        name: 'Block',
        x: 322,
        y: 268,
        rotation: -5,
        w: 209,
        h: 32
      },
      6: {
        name: 'Block',
        x: 118,
        y: 280,
        rotation: 12,
        w: 209,
        h: 32
      },
      7: {
        name: 'Bullet',
        x: 120,
        y: 365,
        rotation: 0,
        w: 4,
        h: 4
      },
      8: {
        name: 'Spider',
        x: 120,
        y: 365,
        rotation: 0,
        w: 24,
        h: 21
      },
      9: {
        name: 'Block',
        x: 50,
        y: 383,
        rotation: -73,
        w: 209,
        h: 32
      },
      10: {
        name: 'Block',
        x: 155,
        y: 429,
        rotation: 5,
        w: 209,
        h: 32
      },
      11: {
        name: 'Block',
        x: 341,
        y: 429,
        rotation: -4,
        w: 209,
        h: 32
      },
      12: {
        name: 'Block',
        x: 353,
        y: 479,
        rotation: 25,
        w: 209,
        h: 32
      },
      13: {
        name: 'Announcer',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      }
    };

    return Level8;

  })();

  Level9 = (function() {

    function Level9() {}

    Level9.data = {
      1: {
        name: 'GameController',
        x: 0,
        y: 0,
        rotation: 0,
        w: 16,
        h: 16
      }
    };

    return Level9;

  })();

  Menu = (function() {

    function Menu() {}

    Menu.data = {
      1: {
        name: 'Menu_1D',
        x: 100,
        y: 300
      }
    };

    return Menu;

  })();

  Builder = (function() {

    Builder.prototype.active = true;

    Builder.prototype.hold = false;

    Builder.prototype.entity = null;

    Builder.prototype.world = null;

    Builder.prototype.grid = null;

    Builder.prototype.editor = null;

    function Builder(editor) {
      this.editor = editor;
      this.world = Game.worlds[0];
    }

    Builder.prototype.output_level = function(name) {
      var e, i, level, n, txt, _i;
      txt = "class " + name + "\n  @data:\n";
      level = AppData.levels[name];
      n = Object.keys(level.data).length;
      for (i = _i = 1; 1 <= n ? _i <= n : _i >= n; i = 1 <= n ? ++_i : --_i) {
        e = level.data[i];
        txt += "    " + i + ":\n";
        txt += "      name: '" + e.name + "'\n";
        txt += "      x: " + e.x + "\n";
        txt += "      y: " + e.y + "\n";
        txt += "      rotation: " + e.rotation + "\n";
        txt += "      w: " + e.w + "\n";
        txt += "      h: " + e.h + "\n";
      }
      return txt;
    };

    Builder.prototype.save_level = function(name) {
      var e, i, level, o, _i, _len, _ref, _results;
      i = 1;
      level = AppData.levels[name];
      level.data = new Object();
      _ref = this.world.all_entities();
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        e = _ref[_i];
        o = new Object();
        o.name = e.name;
        o.x = e.sx;
        o.y = e.sy;
        o.rotation = e.rotation;
        o.w = e.w;
        o.h = e.h;
        level.data[i] = o;
        _results.push(i += 1);
      }
      return _results;
    };

    Builder.prototype.step = function() {
      var e, temp_all_entities, _i, _len;
      if (!this.grid) {
        this.grid = Game.editor.grid;
      }
      if (!this.active) {
        return;
      }
      if (!Game.pause) {
        return;
      }
      if (Keyboard.press('MOUSE_LEFT')) {
        this.hold = this.world.spawn(this.entity, Keyboard.MOUSE_X, Keyboard.MOUSE_Y);
      }
      if (this.hold) {
        this.hold.set_x(Keyboard.MOUSE_X);
        this.hold.set_y(Keyboard.MOUSE_Y);
        if (Keyboard.hold('SHIFT') && this.grid) {
          this.hold.x = this.hold.x - this.hold.x % this.grid.width + this.grid.width / 2;
          this.hold.y = this.hold.y - this.hold.y % this.grid.height + this.grid.height / 2;
        }
        this.hold.sx = this.hold.x;
        this.hold.sy = this.hold.y;
        if (Keyboard.hold('Q')) {
          this.hold.set_rotation(this.hold.rotation + 1);
        }
        if (Keyboard.hold('E')) {
          this.hold.set_rotation(this.hold.rotation - 1);
        }
        if (Keyboard.hold('W')) {
          this.hold.h += 1;
        }
        if (Keyboard.hold('S')) {
          this.hold.h -= 1;
        }
        if (Keyboard.hold('D')) {
          this.hold.w += 1;
        }
        if (Keyboard.hold('A')) {
          this.hold.w -= 1;
        }
      }
      if (Keyboard.release('MOUSE_LEFT')) {
        this.save_level(this.editor.level);
        this.hold = null;
      }
      if (Keyboard.hold('MOUSE_RIGHT')) {
        temp_all_entities = this.world.all_entities().slice(0);
        for (_i = 0, _len = temp_all_entities.length; _i < _len; _i++) {
          e = temp_all_entities[_i];
          if (e.mouse_hits()) {
            e.destroy();
          }
        }
        return this.save_level(this.editor.level);
      }
    };

    return Builder;

  })();

  Editor = (function() {

    Editor.prototype.grid = null;

    Editor.prototype.builder = null;

    Editor.prototype.world = null;

    Editor.prototype.level = '';

    Editor.prototype.entity_selector = null;

    Editor.prototype.pause_button = null;

    Editor.prototype.grid_x = null;

    Editor.prototype.grid_y = null;

    Editor.prototype.grid_width = null;

    Editor.prototype.grid_height = null;

    Editor.prototype.grid_toggle = null;

    function Editor(world) {
      this.set_pause = __bind(this.set_pause, this);

      this.toggle_pause = __bind(this.toggle_pause, this);

      this.toggle_grid = __bind(this.toggle_grid, this);

      this.grid_move = __bind(this.grid_move, this);

      this.entity_change = __bind(this.entity_change, this);

      this.save = __bind(this.save, this);

      this.debug_draw_change = __bind(this.debug_draw_change, this);

      this.save_type_change = __bind(this.save_type_change, this);

      this.level_change = __bind(this.level_change, this);
      this.world = world;
      this.builder = new Builder(this);
      this.grid = new Grid;
      this.grid.art = this.world.art;
      this.level_selector = document.getElementById("level_selector");
      this.level_selector.addEventListener("change", this.level_change, false);
      this.level_change();
      this.save_type_selector = document.getElementById("save_type_selector");
      this.save_type_selector.addEventListener("change", this.save_type_change, false);
      this.save_button = document.getElementById("save_button");
      this.save_button.addEventListener("click", this.save, false);
      this.entity_selector = document.getElementById("entity_selector");
      this.entity_selector.addEventListener("change", this.entity_change, false);
      this.entity_change();
      this.pause_button = document.getElementById("pause_toggle");
      this.pause_button.addEventListener("click", this.toggle_pause, false);
      this.pause_button.addEventListener("click", this.entity_change, false);
      this.debug_draw_checkbox = document.getElementById("debug_draw_checkbox");
      this.debug_draw_checkbox.addEventListener("change", this.debug_draw_change, false);
      this.grid_x = document.getElementById("grid_x");
      this.grid_y = document.getElementById("grid_y");
      this.grid_width = document.getElementById("grid_width");
      this.grid_height = document.getElementById("grid_height");
      this.grid_toggle = document.getElementById("grid_toggle");
      this.grid_x.addEventListener("change", this.grid_move, false);
      this.grid_y.addEventListener("change", this.grid_move, false);
      this.grid_width.addEventListener("change", this.grid_move, false);
      this.grid_height.addEventListener("change", this.grid_move, false);
      this.grid_toggle.addEventListener("click", this.toggle_grid, false);
    }

    Editor.prototype.step = function() {
      return this.builder.step();
    };

    Editor.prototype.level_change = function() {
      this.level = this.level_selector.value;
      this.world.destroy_all();
      return this.world.load_level(this.level);
    };

    Editor.prototype.save_type_change = function() {
      return this.builder.save_type = this.save_type_selector.value;
    };

    Editor.prototype.debug_draw_change = function() {
      return this.world.physics.visible = this.debug_draw_checkbox.checked;
    };

    Editor.prototype.save = function() {
      var blob, level, txt;
      level = this.level_selector.value;
      txt = this.builder.output_level(level);
      blob = new Blob([txt], {
        type: 'text/html'
      });
      return saveAs(blob, "" + level + ".coffee");
    };

    Editor.prototype.entity_change = function() {
      return this.builder.entity = this.entity_selector.value;
    };

    Editor.prototype.grid_move = function() {
      this.grid.x = parseInt(this.grid_x.value);
      this.grid.y = parseInt(this.grid_y.value);
      this.grid.width = parseInt(this.grid_width.value);
      return this.grid.height = parseInt(this.grid_height.value);
    };

    Editor.prototype.toggle_grid = function() {
      if (this.grid.visible) {
        return this.grid.visible = false;
      } else {
        return this.grid.visible = true;
      }
    };

    Editor.prototype.toggle_pause = function() {
      return this.set_pause(!Game.pause);
    };

    Editor.prototype.set_pause = function(pause) {
      var world, _i, _len, _ref, _results;
      Game.pause = pause;
      if (pause) {
        this.pause_button.innerHTML = 'Play';
      } else {
        this.pause_button.innerHTML = 'Pause';
      }
      _ref = Game.worlds;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        world = _ref[_i];
        _results.push(world.pause = Game.pause);
      }
      return _results;
    };

    Editor.prototype.draw = function() {
      return this.grid.draw();
    };

    return Editor;

  })();

  Grid = (function() {

    Grid.prototype.sx = 0;

    Grid.prototype.sy = 0;

    Grid.prototype.visible = false;

    Grid.prototype.x = 0;

    Grid.prototype.y = 0;

    Grid.prototype.width = 16;

    Grid.prototype.height = 16;

    Grid.prototype.world_x = 0;

    Grid.prototype.world_y = 0;

    Grid.prototype.art = null;

    function Grid() {
      this.visible = AppData.grid_on;
    }

    Grid.prototype.draw = function() {
      var i, line_x_n, line_y_n, x, y, _i, _j;
      if (this.visible && this.height > 1 && this.width > 1) {
        this.art.stroke_color('Gray');
        this.art.alpha(0.5);
        line_x_n = AppData.width / this.width;
        line_y_n = AppData.height / this.height;
        for (i = _i = 0; 0 <= line_x_n ? _i < line_x_n : _i > line_x_n; i = 0 <= line_x_n ? ++_i : --_i) {
          x = this.x + i * this.width;
          this.art.lineC(x, this.y, x, this.y + line_y_n * this.height);
        }
        for (i = _j = 0; 0 <= line_y_n ? _j < line_y_n : _j > line_y_n; i = 0 <= line_y_n ? ++_j : --_j) {
          y = this.y + i * this.height;
          this.art.lineC(this.x, y, this.x + line_x_n * this.width, y);
        }
        return this.art.alpha(1);
      }
    };

    return Grid;

  })();

  window.onload = function() {
    return Game.init('build');
  };

  AppData = (function() {

    function AppData() {}

    AppData.game_name = "template";

    AppData.width = 640;

    AppData.height = 480;

    AppData.scale = 1;

    AppData.grid_on = false;

    AppData.physics = true;

    AppData.physics_pixel_per_meter = 16;

    AppData.start_level = 'Menu';

    AppData.anti_aliasing = 'false';

    AppData.entities = {
      'Announcer': Announcer,
      'Block': Block,
      'Bullet': Bullet,
      'Button': Button,
      'Fly': Fly,
      'GameController': GameController,
      'Menu_1D': Menu_1D,
      'Menu_2D': Menu_2D,
      'Spider': Spider,
      'Web': Web
    };

    AppData.sprites = {
      'Background': 'Background.png',
      'Block': 'Block.svg',
      'Bullet': 'Bullet.png',
      'Button': 'Button.svg',
      'Flare': 'Flare.svg',
      'Fly': 'Fly.svg',
      'Marker': 'Marker.svg',
      'PlaceHolder': 'PlaceHolder.png',
      'Spider': 'Spider.svg',
      'Spider_Menu': 'Spider_Menu.svg',
      'Web': 'Web.svg'
    };

    AppData.levels = {
      'Level': Level,
      'Level10': Level10,
      'Level11': Level11,
      'Level2': Level2,
      'Level3': Level3,
      'Level4': Level4,
      'Level5': Level5,
      'Level6': Level6,
      'Level7': Level7,
      'Level8': Level8,
      'Level9': Level9,
      'Menu': Menu
    };

    return AppData;

  })();

}).call(this);
